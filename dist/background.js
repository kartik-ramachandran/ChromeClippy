/*! For license information please see background.js.LICENSE.txt */
(()=>{var e,n,t={},r={};function o(e){var n=r[e];if(void 0!==n)return n.exports;var a=r[e]={exports:{}};return t[e](a,a.exports,o),a.exports}function a(){var e,n,t="function"==typeof Symbol?Symbol:{},r=t.iterator||"@@iterator",o=t.toStringTag||"@@toStringTag";function c(t,r,o,a){var c=r&&r.prototype instanceof s?r:s,l=Object.create(c.prototype);return i(l,"_invoke",function(t,r,o){var a,i,c,s=0,l=o||[],p=!1,f={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(n,t){return a=n,i=0,c=e,f.n=t,u}};function h(t,r){for(i=t,c=r,n=0;!p&&s&&!o&&n<l.length;n++){var o,a=l[n],h=f.p,v=a[2];t>3?(o=v===r)&&(c=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=h&&((o=t<2&&h<a[1])?(i=0,f.v=r,f.n=a[1]):h<v&&(o=t<3||a[0]>r||r>v)&&(a[4]=t,a[5]=r,f.n=v,i=0))}if(o||t>1)return u;throw p=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(p&&1===l&&h(l,v),i=l,c=v;(n=i<2?e:c)||!p;){a||(i?i<3?(i>1&&(f.n=-1),h(i,c)):f.n=c:f.v=c);try{if(s=2,a){if(i||(o="next"),n=a[o]){if(!(n=n.call(a,c)))throw TypeError("iterator result is not an object");if(!n.done)return n;c=n.value,i<2&&(i=0)}else 1===i&&(n=a.return)&&n.call(a),i<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((n=(p=f.n<0)?c:t.call(r,f))!==u)break}catch(n){a=e,i=1,c=n}finally{s=1}}return{value:n,done:p}}}(t,o,a),!0),l}var u={};function s(){}function l(){}function p(){}n=Object.getPrototypeOf;var f=[][r]?n(n([][r]())):(i(n={},r,function(){return this}),n),h=p.prototype=s.prototype=Object.create(f);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,i(e,o,"GeneratorFunction")),e.prototype=Object.create(h),e}return l.prototype=p,i(h,"constructor",p),i(p,"constructor",l),l.displayName="GeneratorFunction",i(p,o,"GeneratorFunction"),i(h),i(h,o,"Generator"),i(h,r,function(){return this}),i(h,"toString",function(){return"[object Generator]"}),(a=function(){return{w:c,m:v}})()}function i(e,n,t,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}i=function(e,n,t,r){function a(n,t){i(e,n,function(e){return this._invoke(n,t,e)})}n?o?o(e,n,{value:t,enumerable:!r,configurable:!r,writable:!r}):e[n]=t:(a("next",0),a("throw",1),a("return",2))},i(e,n,t,r)}function c(e,n,t,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void t(e)}c.done?n(u):Promise.resolve(u).then(r,o)}function u(e){return function(){var n=this,t=arguments;return new Promise(function(r,o){var a=e.apply(n,t);function i(e){c(a,r,o,i,u,"next",e)}function u(e){c(a,r,o,i,u,"throw",e)}i(void 0)})}}o.m=t,o.d=(e,n)=>{for(var t in n)o.o(n,t)&&!o.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},o.f={},o.e=e=>Promise.all(Object.keys(o.f).reduce((n,t)=>(o.f[t](e,n),n),[])),o.u=e=>"vendors.chunk.js",o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),e={},n="ai-clippy-2025:",o.l=(t,r,a,i)=>{if(e[t])e[t].push(r);else{var c,u;if(void 0!==a)for(var s=document.getElementsByTagName("script"),l=0;l<s.length;l++){var p=s[l];if(p.getAttribute("src")==t||p.getAttribute("data-webpack")==n+a){c=p;break}}c||(u=!0,(c=document.createElement("script")).charset="utf-8",c.timeout=120,o.nc&&c.setAttribute("nonce",o.nc),c.setAttribute("data-webpack",n+a),c.src=t),e[t]=[r];var f=(n,r)=>{c.onerror=c.onload=null,clearTimeout(h);var o=e[t];if(delete e[t],c.parentNode&&c.parentNode.removeChild(c),o&&o.forEach(e=>e(r)),n)return n(r)},h=setTimeout(f.bind(null,void 0,{type:"timeout",target:c}),12e4);c.onerror=f.bind(null,c.onerror),c.onload=f.bind(null,c.onload),u&&document.head.appendChild(c)}},o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;o.g.importScripts&&(e=o.g.location+"");var n=o.g.document;if(!e&&n&&(n.currentScript&&"SCRIPT"===n.currentScript.tagName.toUpperCase()&&(e=n.currentScript.src),!e)){var t=n.getElementsByTagName("script");if(t.length)for(var r=t.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=t[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=e})(),(()=>{var e={471:0};o.f.j=(n,t)=>{var r=o.o(e,n)?e[n]:void 0;if(0!==r)if(r)t.push(r[2]);else{var a=new Promise((t,o)=>r=e[n]=[t,o]);t.push(r[2]=a);var i=o.p+o.u(n),c=new Error;o.l(i,t=>{if(o.o(e,n)&&(0!==(r=e[n])&&(e[n]=void 0),r)){var a=t&&("load"===t.type?"missing":t.type),i=t&&t.target&&t.target.src;c.message="Loading chunk "+n+" failed.\n("+a+": "+i+")",c.name="ChunkLoadError",c.type=a,c.request=i,r[1](c)}},"chunk-"+n,n)}};var n=(n,t)=>{var r,a,[i,c,u]=t,s=0;if(i.some(n=>0!==e[n])){for(r in c)o.o(c,r)&&(o.m[r]=c[r]);u&&u(o)}for(n&&n(t);s<i.length;s++)a=i[s],o.o(e,a)&&e[a]&&e[a][0](),e[a]=0},t=self.webpackChunkai_clippy_2025=self.webpackChunkai_clippy_2025||[];t.forEach(n.bind(null,0)),t.push=n.bind(null,t.push.bind(t))})(),console.log("🚀 AI Clippy 2025 Background Script - Chrome Built-in AI Version!");var s=null,l=!1;function p(){return f.apply(this,arguments)}function f(){return(f=u(a().m(function e(){var n,t,r;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!s){e.n=1;break}return e.a(2,s);case 1:if(!l){e.n=5;break}case 2:if(!l){e.n=4;break}return e.n=3,new Promise(function(e){return setTimeout(e,100)});case 3:e.n=2;break;case 4:return e.a(2,s);case 5:return e.p=5,l=!0,console.log("🔄 Loading backup AI (Google GenAI SDK)..."),e.n=6,o.e(96).then(o.bind(o,487));case 6:return n=e.v,t=n.GoogleGenAI,s=new t({apiKey:"AIzaSyCCq0_MKtYgeiKzYIrOxtQcBZjmWkX2IT8"}),console.log("✅ Backup AI loaded successfully"),e.a(2,s);case 7:return e.p=7,r=e.v,console.error("❌ Failed to load backup AI:",r),e.a(2,null);case 8:return e.p=8,l=!1,e.f(8);case 9:return e.a(2)}},e,null,[[5,7,8,9]])}))).apply(this,arguments)}function h(){return(h=u(a().m(function e(n,t){var r,o,i,c,u,s,l,p,f,h,d,y,b;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:e.p=0,r=n.data,o=r.action,i=r.text,c=r.options,y=o,e.n="IMPROVE_TEXT"===y?1:"TRANSLATE"===y?3:"SUMMARIZE"===y?5:"PROOFREAD"===y?7:"EXPLAIN"===y?9:"REWRITE"===y?11:"GENERAL_AI"===y?13:15;break;case 1:return e.n=2,v(i,c);case 2:return u=e.v,t({success:!0,result:u}),e.a(3,16);case 3:return e.n=4,g(i,c);case 4:return s=e.v,t({success:!0,result:s}),e.a(3,16);case 5:return e.n=6,m(i,c);case 6:return l=e.v,t({success:!0,result:l}),e.a(3,16);case 7:return e.n=8,A(i);case 8:return p=e.v,t({success:!0,result:p}),e.a(3,16);case 9:return e.n=10,E(i);case 10:return f=e.v,t({success:!0,result:f}),e.a(3,16);case 11:return e.n=12,w(i,c);case 12:return h=e.v,t({success:!0,result:h}),e.a(3,16);case 13:return e.n=14,S(i);case 14:return d=e.v,t({success:!0,result:d}),e.a(3,16);case 15:t({success:!1,error:"Unknown action"});case 16:e.n=18;break;case 17:e.p=17,b=e.v,console.error("AI Request failed:",b),t({success:!1,error:b.message});case 18:return e.a(2)}},e,null,[[0,17]])}))).apply(this,arguments)}function v(e){return d.apply(this,arguments)}function d(){return d=u(a().m(function e(n){var t,r=arguments;return a().w(function(e){for(;;)switch(e.n){case 0:return t=r.length>1&&void 0!==r[1]?r[1]:{},console.log("Writer API not available in service worker, using backup AI"),e.n=1,P("Improve this text to be more ".concat(t.tone||"professional",': "').concat(n,'"'));case 1:return e.a(2,e.v)}},e)})),d.apply(this,arguments)}function g(e){return y.apply(this,arguments)}function y(){return y=u(a().m(function e(n){var t,r,o=arguments;return a().w(function(e){for(;;)switch(e.n){case 0:return t=o.length>1&&void 0!==o[1]?o[1]:{},console.log("Translator API not available in service worker, using backup AI"),r=t.to||"Spanish",e.n=1,P("Translate this text from ".concat(t.from||"English"," to ").concat(r,': "').concat(n,'"'));case 1:return e.a(2,e.v)}},e)})),y.apply(this,arguments)}function m(e){return b.apply(this,arguments)}function b(){return b=u(a().m(function e(n){var t,r,o=arguments;return a().w(function(e){for(;;)switch(e.n){case 0:return t=o.length>1&&void 0!==o[1]?o[1]:{},console.log("Summarizer API not available in service worker, using backup AI"),r="short"===t.length?"in 2-3 sentences":"long"===t.length?"in detail":"concisely",e.n=1,P("Summarize this text ".concat(r,': "').concat(n,'"'));case 1:return e.a(2,e.v)}},e)})),b.apply(this,arguments)}function w(e){return k.apply(this,arguments)}function k(){return k=u(a().m(function e(n){var t,r,o=arguments;return a().w(function(e){for(;;)switch(e.n){case 0:return t=o.length>1&&void 0!==o[1]?o[1]:{},console.log("Rewriter API not available in service worker, using backup AI"),r=t.tone||"neutral",e.n=1,P("Rewrite this text with a ".concat(r,' tone: "').concat(n,'"'));case 1:return e.a(2,e.v)}},e)})),k.apply(this,arguments)}function A(e){return I.apply(this,arguments)}function I(){return(I=u(a().m(function e(n){return a().w(function(e){for(;;)switch(e.n){case 0:return console.log("Language Model API not available in service worker, using backup AI"),e.n=1,P('Please proofread this text for grammar, spelling, and style: "'.concat(n,'"'));case 1:return e.a(2,e.v)}},e)}))).apply(this,arguments)}function E(e){return T.apply(this,arguments)}function T(){return(T=u(a().m(function e(n){return a().w(function(e){for(;;)switch(e.n){case 0:return console.log("Language Model API not available in service worker, using backup AI"),e.n=1,P('Please explain this clearly and simply: "'.concat(n,'"'));case 1:return e.a(2,e.v)}},e)}))).apply(this,arguments)}function S(e){return x.apply(this,arguments)}function x(){return(x=u(a().m(function e(n){return a().w(function(e){for(;;)switch(e.n){case 0:return console.log("Language Model API not available in service worker, using backup AI"),e.n=1,P('You are Clippy, a helpful and friendly AI assistant. Be enthusiastic and helpful! User says: "'.concat(n,'"'));case 1:return e.a(2,e.v)}},e)}))).apply(this,arguments)}function P(e){return C.apply(this,arguments)}function C(){return(C=u(a().m(function e(n){var t,r,o;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,p();case 1:if(t=e.v){e.n=2;break}throw new Error("Backup AI not available");case 2:return e.n=3,t.models.generateContent({model:"gemini-2.5-flash",contents:n});case 3:return r=e.v,e.a(2,"".concat(r.text," ✨ (Enhanced by backup AI)"));case 4:throw e.p=4,o=e.v,console.error("Backup AI Error:",o),new Error("Both Chrome Built-in AI and backup AI failed");case 5:return e.a(2)}},e,null,[[0,4]])}))).apply(this,arguments)}function O(){return(O=u(a().m(function e(n,t){var r,o;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,chrome.tabs.captureVisibleTab(n,{format:"png"});case 1:r=e.v,t({success:!0,screenshot:r}),e.n=3;break;case 2:e.p=2,o=e.v,t({success:!1,error:o.message});case 3:return e.a(2)}},e,null,[[0,2]])}))).apply(this,arguments)}function j(){return(j=u(a().m(function e(n){return a().w(function(e){for(;;)switch(e.n){case 0:n({success:!0,message:"File access ready!"});case 1:return e.a(2)}},e)}))).apply(this,arguments)}function _(){return(_=u(a().m(function e(n,t){var r,o,i,c,u,s;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,r=n.data,o=r.query,i=r.context,e.n=1,S(o);case 1:c=e.v,u=R(0,i),t({success:!0,response:c,suggestions:u,timestamp:Date.now()}),e.n=3;break;case 2:e.p=2,s=e.v,console.error("Conversation request failed:",s),t({success:!1,error:s.message,fallback:"I'm having trouble connecting to Chrome's Built-in AI. Try asking something else!"});case 3:return e.a(2)}},e,null,[[0,2]])}))).apply(this,arguments)}function R(e,n){var t,r,o,a=[];return null!=n&&null!==(t=n.url)&&void 0!==t&&t.includes("github.com")?a.push({text:"Explain this code",icon:"💻"},{text:"Review this repository",icon:"📂"}):(null!=n&&null!==(r=n.url)&&void 0!==r&&r.includes("mail")||null!=n&&null!==(o=n.url)&&void 0!==o&&o.includes("gmail"))&&a.push({text:"Help write an email",icon:"✉️"},{text:"Make it more professional",icon:"✨"}),a.push({text:"Take a screenshot",icon:"📸"},{text:"Help with writing",icon:"✍️"},{text:"Translate text",icon:"🌍"},{text:"Summarize content",icon:"📄"}),a.slice(0,4)}chrome.runtime.onInstalled.addListener(function(){console.log("Clippy is ready to help!"),chrome.storage.sync.set({clippyEnabled:!0,helpWithWriting:!0,helpWithTranslation:!0,helpWithSummarization:!0,helpWithCode:!0,personalityLevel:"classic",position:{bottom:20,right:20}})}),chrome.runtime.onMessage.addListener(function(e,n,t){return"AI_REQUEST"===e.type?(function(e,n){h.apply(this,arguments)}(e,t),!0):"TAKE_SCREENSHOT"===e.type?(function(e,n){O.apply(this,arguments)}(n.tab.id,t),!0):"ACCESS_FILES"===e.type?(function(e){j.apply(this,arguments)}(t),!0):"CONVERSATION_REQUEST"===e.type?(function(e,n){_.apply(this,arguments)}(e,t),!0):void 0}),console.log("Clippy background script ready with Gemini integration!")})();