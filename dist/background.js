/*! For license information please see background.js.LICENSE.txt */
(()=>{var e,r,n={},t={};function a(e){var r=t[e];if(void 0!==r)return r.exports;var o=t[e]={exports:{}};return n[e](o,o.exports,a),o.exports}function o(){var e,r,n="function"==typeof Symbol?Symbol:{},t=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function c(n,t,a,o){var c=t&&t.prototype instanceof u?t:u,l=Object.create(c.prototype);return i(l,"_invoke",function(n,t,a){var o,i,c,u=0,l=a||[],p=!1,f={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(r,n){return o=r,i=0,c=e,f.n=n,s}};function h(n,t){for(i=n,c=t,r=0;!p&&u&&!a&&r<l.length;r++){var a,o=l[r],h=f.p,d=o[2];n>3?(a=d===t)&&(c=o[(i=o[4])?5:(i=3,3)],o[4]=o[5]=e):o[0]<=h&&((a=n<2&&h<o[1])?(i=0,f.v=t,f.n=o[1]):h<d&&(a=n<3||o[0]>t||t>d)&&(o[4]=n,o[5]=t,f.n=d,i=0))}if(a||n>1)return s;throw p=!0,t}return function(a,l,d){if(u>1)throw TypeError("Generator is already running");for(p&&1===l&&h(l,d),i=l,c=d;(r=i<2?e:c)||!p;){o||(i?i<3?(i>1&&(f.n=-1),h(i,c)):f.n=c:f.v=c);try{if(u=2,o){if(i||(a="next"),r=o[a]){if(!(r=r.call(o,c)))throw TypeError("iterator result is not an object");if(!r.done)return r;c=r.value,i<2&&(i=0)}else 1===i&&(r=o.return)&&r.call(o),i<2&&(c=TypeError("The iterator does not provide a '"+a+"' method"),i=1);o=e}else if((r=(p=f.n<0)?c:n.call(t,f))!==s)break}catch(r){o=e,i=1,c=r}finally{u=1}}return{value:r,done:p}}}(n,a,o),!0),l}var s={};function u(){}function l(){}function p(){}r=Object.getPrototypeOf;var f=[][t]?r(r([][t]())):(i(r={},t,function(){return this}),r),h=p.prototype=u.prototype=Object.create(f);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,i(e,a,"GeneratorFunction")),e.prototype=Object.create(h),e}return l.prototype=p,i(h,"constructor",p),i(p,"constructor",l),l.displayName="GeneratorFunction",i(p,a,"GeneratorFunction"),i(h),i(h,a,"Generator"),i(h,t,function(){return this}),i(h,"toString",function(){return"[object Generator]"}),(o=function(){return{w:c,m:d}})()}function i(e,r,n,t){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}i=function(e,r,n,t){function o(r,n){i(e,r,function(e){return this._invoke(r,n,e)})}r?a?a(e,r,{value:n,enumerable:!t,configurable:!t,writable:!t}):e[r]=n:(o("next",0),o("throw",1),o("return",2))},i(e,r,n,t)}function c(e,r,n,t,a,o,i){try{var c=e[o](i),s=c.value}catch(e){return void n(e)}c.done?r(s):Promise.resolve(s).then(t,a)}function s(e){return function(){var r=this,n=arguments;return new Promise(function(t,a){var o=e.apply(r,n);function i(e){c(o,t,a,i,s,"next",e)}function s(e){c(o,t,a,i,s,"throw",e)}i(void 0)})}}a.m=n,a.d=(e,r)=>{for(var n in r)a.o(r,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce((r,n)=>(a.f[n](e,r),r),[])),a.u=e=>"vendors.chunk.js",a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),e={},r="ai-clippy-2025:",a.l=(n,t,o,i)=>{if(e[n])e[n].push(t);else{var c,s;if(void 0!==o)for(var u=document.getElementsByTagName("script"),l=0;l<u.length;l++){var p=u[l];if(p.getAttribute("src")==n||p.getAttribute("data-webpack")==r+o){c=p;break}}c||(s=!0,(c=document.createElement("script")).charset="utf-8",c.timeout=120,a.nc&&c.setAttribute("nonce",a.nc),c.setAttribute("data-webpack",r+o),c.src=n),e[n]=[t];var f=(r,t)=>{c.onerror=c.onload=null,clearTimeout(h);var a=e[n];if(delete e[n],c.parentNode&&c.parentNode.removeChild(c),a&&a.forEach(e=>e(t)),r)return r(t)},h=setTimeout(f.bind(null,void 0,{type:"timeout",target:c}),12e4);c.onerror=f.bind(null,c.onerror),c.onload=f.bind(null,c.onload),s&&document.head.appendChild(c)}},a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;a.g.importScripts&&(e=a.g.location+"");var r=a.g.document;if(!e&&r&&(r.currentScript&&"SCRIPT"===r.currentScript.tagName.toUpperCase()&&(e=r.currentScript.src),!e)){var n=r.getElementsByTagName("script");if(n.length)for(var t=n.length-1;t>-1&&(!e||!/^http(s?):/.test(e));)e=n[t--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e})(),(()=>{var e={471:0};a.f.j=(r,n)=>{var t=a.o(e,r)?e[r]:void 0;if(0!==t)if(t)n.push(t[2]);else{var o=new Promise((n,a)=>t=e[r]=[n,a]);n.push(t[2]=o);var i=a.p+a.u(r),c=new Error;a.l(i,n=>{if(a.o(e,r)&&(0!==(t=e[r])&&(e[r]=void 0),t)){var o=n&&("load"===n.type?"missing":n.type),i=n&&n.target&&n.target.src;c.message="Loading chunk "+r+" failed.\n("+o+": "+i+")",c.name="ChunkLoadError",c.type=o,c.request=i,t[1](c)}},"chunk-"+r,r)}};var r=(r,n)=>{var t,o,[i,c,s]=n,u=0;if(i.some(r=>0!==e[r])){for(t in c)a.o(c,t)&&(a.m[t]=c[t]);s&&s(a)}for(r&&r(n);u<i.length;u++)o=i[u],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0},n=self.webpackChunkai_clippy_2025=self.webpackChunkai_clippy_2025||[];n.forEach(r.bind(null,0)),n.push=r.bind(null,n.push.bind(n))})(),console.log("🚀 AI Clippy 2025 Background Script - Chrome Built-in AI Version!");var u=null,l=!1;function p(){return f.apply(this,arguments)}function f(){return(f=s(o().m(function e(){var r,n,t;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!u){e.n=1;break}return e.a(2,u);case 1:if(!l){e.n=5;break}case 2:if(!l){e.n=4;break}return e.n=3,new Promise(function(e){return setTimeout(e,100)});case 3:e.n=2;break;case 4:return e.a(2,u);case 5:return e.p=5,l=!0,console.log("🔄 Loading backup AI (Google GenAI SDK)..."),e.n=6,a.e(96).then(a.bind(a,487));case 6:return r=e.v,n=r.GoogleGenAI,u=new n({apiKey:"AIzaSyCCq0_MKtYgeiKzYIrOxtQcBZjmWkX2IT8"}),console.log("✅ Backup AI loaded successfully"),e.a(2,u);case 7:return e.p=7,t=e.v,console.error("❌ Failed to load backup AI:",t),e.a(2,null);case 8:return e.p=8,l=!1,e.f(8);case 9:return e.a(2)}},e,null,[[5,7,8,9]])}))).apply(this,arguments)}function h(){return(h=s(o().m(function e(r,n){var t,a,i,c,s,u,l,p,f,h,v,g,y;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:e.p=0,t=r.data,a=t.action,i=t.text,c=t.options,g=a,e.n="IMPROVE_TEXT"===g?1:"TRANSLATE"===g?3:"SUMMARIZE"===g?5:"PROOFREAD"===g?7:"EXPLAIN"===g?9:"REWRITE"===g?11:"GENERAL_AI"===g?13:15;break;case 1:return e.n=2,d(i,c);case 2:return s=e.v,n({success:!0,result:s}),e.a(3,16);case 3:return e.n=4,m(i,c);case 4:return u=e.v,n({success:!0,result:u}),e.a(3,16);case 5:return e.n=6,w(i,c);case 6:return l=e.v,n({success:!0,result:l}),e.a(3,16);case 7:return e.n=8,A(i);case 8:return p=e.v,n({success:!0,result:p}),e.a(3,16);case 9:return e.n=10,I(i);case 10:return f=e.v,n({success:!0,result:f}),e.a(3,16);case 11:return e.n=12,b(i,c);case 12:return h=e.v,n({success:!0,result:h}),e.a(3,16);case 13:return e.n=14,x(i);case 14:return v=e.v,n({success:!0,result:v}),e.a(3,16);case 15:n({success:!1,error:"Unknown action"});case 16:e.n=18;break;case 17:e.p=17,y=e.v,console.error("AI Request failed:",y),n({success:!1,error:y.message});case 18:return e.a(2)}},e,null,[[0,17]])}))).apply(this,arguments)}function d(e){return v.apply(this,arguments)}function v(){return v=s(o().m(function e(r){var n,t,a,i,c,s=arguments;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=s.length>1&&void 0!==s[1]?s[1]:{},e.p=1,null!==(t=window.ai)&&void 0!==t&&t.writer){e.n=2;break}throw new Error("Writer API not available");case 2:return e.n=3,window.ai.writer.create({tone:n.tone||"neutral",format:"plain-text",length:"medium"});case 3:return a=e.v,e.n=4,a.write("Improve this text: ".concat(r));case 4:return i=e.v,a.destroy(),e.a(2,i);case 5:return e.p=5,c=e.v,console.log("Chrome Writer API failed, using backup:",c.message),e.n=6,S("Improve this text to be more ".concat(n.tone||"professional",': "').concat(r,'"'));case 6:return e.a(2,e.v)}},e,null,[[1,5]])})),v.apply(this,arguments)}function m(e){return g.apply(this,arguments)}function g(){return g=s(o().m(function e(r){var n,t,a,i,c,s=arguments;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=s.length>1&&void 0!==s[1]?s[1]:{},e.p=1,null!==(t=window.ai)&&void 0!==t&&t.translator){e.n=2;break}throw new Error("Translator API not available");case 2:return e.n=3,window.ai.translator.create({sourceLanguage:n.from||"en",targetLanguage:n.to||"es"});case 3:return a=e.v,e.n=4,a.translate(r);case 4:return i=e.v,a.destroy(),e.a(2,i);case 5:return e.p=5,c=e.v,console.log("Chrome Translator API failed, using backup:",c.message),e.n=6,S("Translate this text to ".concat(n.to||"Spanish",': "').concat(r,'"'));case 6:return e.a(2,e.v)}},e,null,[[1,5]])})),g.apply(this,arguments)}function w(e){return y.apply(this,arguments)}function y(){return y=s(o().m(function e(r){var n,t,a,i,c,s=arguments;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=s.length>1&&void 0!==s[1]?s[1]:{},e.p=1,null!==(t=window.ai)&&void 0!==t&&t.summarizer){e.n=2;break}throw new Error("Summarizer API not available");case 2:return e.n=3,window.ai.summarizer.create({type:n.type||"key-points",format:"plain-text",length:n.length||"short"});case 3:return a=e.v,e.n=4,a.summarize(r);case 4:return i=e.v,a.destroy(),e.a(2,i);case 5:return e.p=5,c=e.v,console.log("Chrome Summarizer API failed, using backup:",c.message),e.n=6,S('Summarize this text: "'.concat(r,'"'));case 6:return e.a(2,e.v)}},e,null,[[1,5]])})),y.apply(this,arguments)}function b(e){return k.apply(this,arguments)}function k(){return k=s(o().m(function e(r){var n,t,a,i,c,s=arguments;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=s.length>1&&void 0!==s[1]?s[1]:{},e.p=1,null!==(t=window.ai)&&void 0!==t&&t.rewriter){e.n=2;break}throw new Error("Rewriter API not available");case 2:return e.n=3,window.ai.rewriter.create({tone:n.tone||"as-is",format:"plain-text",length:n.length||"as-is"});case 3:return a=e.v,e.n=4,a.rewrite(r);case 4:return i=e.v,a.destroy(),e.a(2,i);case 5:return e.p=5,c=e.v,console.log("Chrome Rewriter API failed, using backup:",c.message),e.n=6,S('Rewrite this text: "'.concat(r,'"'));case 6:return e.a(2,e.v)}},e,null,[[1,5]])})),k.apply(this,arguments)}function A(e){return E.apply(this,arguments)}function E(){return(E=s(o().m(function e(r){var n,t,a,i;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,null!==(n=window.ai)&&void 0!==n&&n.languageModel){e.n=1;break}throw new Error("Language Model API not available");case 1:return e.n=2,window.ai.languageModel.create({systemPrompt:"You are a professional proofreader. Check grammar, spelling, and style."});case 2:return t=e.v,e.n=3,t.prompt('Please proofread this text: "'.concat(r,'"'));case 3:return a=e.v,t.destroy(),e.a(2,a);case 4:return e.p=4,i=e.v,console.log("Chrome Language Model API failed, using backup:",i.message),e.n=5,S('Proofread this text: "'.concat(r,'"'));case 5:return e.a(2,e.v)}},e,null,[[0,4]])}))).apply(this,arguments)}function I(e){return P.apply(this,arguments)}function P(){return(P=s(o().m(function e(r){var n,t,a,i;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,null!==(n=window.ai)&&void 0!==n&&n.languageModel){e.n=1;break}throw new Error("Language Model API not available");case 1:return e.n=2,window.ai.languageModel.create({systemPrompt:"You are a helpful teacher. Explain concepts clearly and simply."});case 2:return t=e.v,e.n=3,t.prompt('Please explain this: "'.concat(r,'"'));case 3:return a=e.v,t.destroy(),e.a(2,a);case 4:return e.p=4,i=e.v,console.log("Chrome Language Model API failed, using backup:",i.message),e.n=5,S('Explain this text: "'.concat(r,'"'));case 5:return e.a(2,e.v)}},e,null,[[0,4]])}))).apply(this,arguments)}function x(e){return T.apply(this,arguments)}function T(){return(T=s(o().m(function e(r){var n,t,a,i;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,null!==(n=window.ai)&&void 0!==n&&n.languageModel){e.n=1;break}throw new Error("Language Model API not available");case 1:return e.n=2,window.ai.languageModel.create({systemPrompt:"You are Clippy, a helpful and friendly AI assistant. Be enthusiastic and helpful!"});case 2:return t=e.v,e.n=3,t.prompt(r);case 3:return a=e.v,t.destroy(),e.a(2,a);case 4:return e.p=4,i=e.v,console.log("Chrome Language Model API failed, using backup:",i.message),e.n=5,S(r);case 5:return e.a(2,e.v)}},e,null,[[0,4]])}))).apply(this,arguments)}function S(e){return C.apply(this,arguments)}function C(){return(C=s(o().m(function e(r){var n,t,a;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,p();case 1:if(n=e.v){e.n=2;break}throw new Error("Backup AI not available");case 2:return e.n=3,n.models.generateContent({model:"gemini-2.5-flash",contents:r});case 3:return t=e.v,e.a(2,"".concat(t.text," ✨ (Enhanced by backup AI)"));case 4:throw e.p=4,a=e.v,console.error("Backup AI Error:",a),new Error("Both Chrome Built-in AI and backup AI failed");case 5:return e.a(2)}},e,null,[[0,4]])}))).apply(this,arguments)}function O(){return(O=s(o().m(function e(r,n){var t,a;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,chrome.tabs.captureVisibleTab(r,{format:"png"});case 1:t=e.v,n({success:!0,screenshot:t}),e.n=3;break;case 2:e.p=2,a=e.v,n({success:!1,error:a.message});case 3:return e.a(2)}},e,null,[[0,2]])}))).apply(this,arguments)}function M(){return(M=s(o().m(function e(r){return o().w(function(e){for(;;)switch(e.n){case 0:r({success:!0,message:"File access ready!"});case 1:return e.a(2)}},e)}))).apply(this,arguments)}function j(){return(j=s(o().m(function e(r,n){var t,a,i,c,s,u;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,t=r.data,a=t.query,i=t.context,e.n=1,x(a);case 1:c=e.v,s=_(0,i),n({success:!0,response:c,suggestions:s,timestamp:Date.now()}),e.n=3;break;case 2:e.p=2,u=e.v,console.error("Conversation request failed:",u),n({success:!1,error:u.message,fallback:"I'm having trouble connecting to Chrome's Built-in AI. Try asking something else!"});case 3:return e.a(2)}},e,null,[[0,2]])}))).apply(this,arguments)}function _(e,r){var n,t,a,o=[];return null!=r&&null!==(n=r.url)&&void 0!==n&&n.includes("github.com")?o.push({text:"Explain this code",icon:"💻"},{text:"Review this repository",icon:"📂"}):(null!=r&&null!==(t=r.url)&&void 0!==t&&t.includes("mail")||null!=r&&null!==(a=r.url)&&void 0!==a&&a.includes("gmail"))&&o.push({text:"Help write an email",icon:"✉️"},{text:"Make it more professional",icon:"✨"}),o.push({text:"Take a screenshot",icon:"📸"},{text:"Help with writing",icon:"✍️"},{text:"Translate text",icon:"🌍"},{text:"Summarize content",icon:"📄"}),o.slice(0,4)}chrome.runtime.onInstalled.addListener(function(){console.log("Clippy is ready to help!"),chrome.storage.sync.set({clippyEnabled:!0,helpWithWriting:!0,helpWithTranslation:!0,helpWithSummarization:!0,helpWithCode:!0,personalityLevel:"classic",position:{bottom:20,right:20}})}),chrome.runtime.onMessage.addListener(function(e,r,n){return"AI_REQUEST"===e.type?(function(e,r){h.apply(this,arguments)}(e,n),!0):"TAKE_SCREENSHOT"===e.type?(function(e,r){O.apply(this,arguments)}(r.tab.id,n),!0):"ACCESS_FILES"===e.type?(function(e){M.apply(this,arguments)}(n),!0):"CONVERSATION_REQUEST"===e.type?(function(e,r){j.apply(this,arguments)}(e,n),!0):void 0}),console.log("Clippy background script ready with Gemini integration!")})();